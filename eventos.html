<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Eventos Esportivos - Fotos63</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary-color: #f39c12;
            --secondary-color: #e67e22;
            --accent-color: #d35400;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f1c40f;
            --info-color: #3498db;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: white !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }

        .hero-section {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 80px 0;
            margin-bottom: 40px;
        }

        .event-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            margin-bottom: 30px;
            height: 100%;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .event-image {
            width: 100%;
            height: 250px;
            object-fit: cover;
            position: relative;
        }

        .event-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: var(--primary-color);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .event-price {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .event-content {
            padding: 25px;
        }

        .event-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .event-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .event-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            font-size: 0.9rem;
            color: #666;
        }

        .event-meta-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .event-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 20px;
        }

        .event-tag {
            background: rgba(243, 156, 18, 0.1);
            color: var(--primary-color);
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: 500;
        }

        .event-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 15px;
            border-top: 1px solid #eee;
        }

        .event-capacity {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9rem;
        }

        .capacity-bar {
            width: 100px;
            height: 6px;
            background: #eee;
            border-radius: 3px;
            overflow: hidden;
        }

        .capacity-fill {
            height: 100%;
            background: var(--success-color);
            transition: width 0.3s ease;
        }

        .event-rating {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--warning-color);
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .btn-outline-primary {
            border: 2px solid var(--primary-color);
            color: var(--primary-color);
            border-radius: 25px;
            padding: 8px 20px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-outline-primary:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .category-btn {
            padding: 10px 20px;
            border: 2px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            border-radius: 25px;
            transition: all 0.3s ease;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .category-btn.active,
        .category-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .stats-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .stat-item {
            text-align: center;
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .loading-spinner {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .footer {
            background: var(--dark-color);
            color: white;
            text-align: center;
            padding: 40px 0;
            margin-top: 60px;
        }

        .whatsapp-btn {
            background: #25d366;
            color: white;
            border: none;
            border-radius: 25px;
            padding: 8px 15px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            background: #128c7e;
            color: white;
            transform: translateY(-2px);
        }

        .photographer-offer {
            background: rgba(243, 156, 18, 0.1);
            border: 1px solid var(--primary-color);
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
        }

        .photographer-offer h6 {
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        @media (max-width: 768px) {
            .hero-section {
                padding: 60px 0;
            }
            
            .event-meta {
                flex-direction: column;
                gap: 10px;
            }
            
            .event-footer {
                flex-direction: column;
                gap: 15px;
                align-items: stretch;
            }
            
            .category-filter {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-camera-fill me-2"></i>Fotos63
            </a>
            
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="index.html">In√≠cio</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="galeria.html">Galeria</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="eventos.html">Eventos</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#sobre">Sobre</a>
                    </li>
                </ul>
                
                <div class="navbar-nav">
                    <a class="nav-link" href="#" onclick="showLogin()">
                        <i class="bi bi-box-arrow-in-right me-1"></i>Entrar
                    </a>
                    <a class="nav-link" href="#" onclick="showRegister()">
                        <i class="bi bi-person-plus me-1"></i>Cadastrar
                    </a>
                    <a class="nav-link" href="#" onclick="showCreateEvent()">
                        <i class="bi bi-plus-circle me-1"></i>Criar Evento
                    </a>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-8">
                    <h1 class="display-4 fw-bold mb-3">Eventos Esportivos do Tocantins</h1>
                    <p class="lead mb-4">Descubra corridas, competi√ß√µes e eventos esportivos incr√≠veis. Participe, organize ou contrate fot√≥grafos profissionais para registrar seus momentos especiais.</p>
                    <div class="d-flex gap-3 flex-wrap">
                        <a href="#eventos" class="btn btn-light btn-lg">
                            <i class="bi bi-calendar-event me-2"></i>Ver Eventos
                        </a>
                        <a href="#" onclick="showCreateEvent()" class="btn btn-outline-light btn-lg">
                            <i class="bi bi-plus-circle me-2"></i>Criar Evento
                        </a>
                    </div>
                </div>
                <div class="col-lg-4 text-center">
                    <i class="bi bi-trophy" style="font-size: 8rem; opacity: 0.3;"></i>
                </div>
            </div>
        </div>
    </section>

    <div class="container">
        <!-- Stats Section -->
        <div class="stats-section">
            <div class="row">
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number" id="totalEvents">0</div>
                        <p class="text-muted">Eventos Ativos</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number" id="totalParticipants">0</div>
                        <p class="text-muted">Participantes</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number" id="totalPhotographers">0</div>
                        <p class="text-muted">Fot√≥grafos</p>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="stat-item">
                        <div class="stat-number">100%</div>
                        <p class="text-muted">Divers√£o</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Filter Section -->
        <div class="filter-section">
            <div class="row">
                <div class="col-md-8">
                    <h5 class="mb-3">Encontre o Evento Perfeito</h5>
                    <div class="input-group">
                        <input type="text" class="form-control form-control-lg" id="searchInput" 
                               placeholder="Buscar por nome, localiza√ß√£o, tipo...">
                        <button class="btn btn-primary" onclick="searchEvents()">
                            <i class="bi bi-search"></i>
                        </button>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5 class="mb-3">Ordenar por</h5>
                    <select class="form-control form-control-lg" id="sortSelect" onchange="sortEvents()">
                        <option value="date_asc">Data Mais Pr√≥xima</option>
                        <option value="date_desc">Data Mais Distante</option>
                        <option value="price_asc">Menor Pre√ßo</option>
                        <option value="price_desc">Maior Pre√ßo</option>
                        <option value="rating">Melhor Avaliado</option>
                        <option value="participants">Mais Participantes</option>
                    </select>
                </div>
            </div>
            
            <h6 class="mt-4 mb-3">Filtrar por Categoria</h6>
            <div class="category-filter" id="categoryFilter">
                <!-- Categorias ser√£o carregadas aqui -->
            </div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading-spinner">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
        </div>

        <!-- Events Grid -->
        <div id="eventsGrid" class="row" style="display: none;">
            <!-- Eventos ser√£o carregados aqui -->
        </div>

        <!-- Load More Button -->
        <div class="text-center mt-4">
            <button class="btn btn-outline-primary btn-lg" id="loadMoreBtn" onclick="loadMoreEvents()" style="display: none;">
                <i class="bi bi-arrow-down-circle me-2"></i>Carregar Mais Eventos
            </button>
        </div>
    </div>

    <!-- Event Details Modal -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalEventTitle">T√≠tulo do Evento</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <img id="modalEventImage" src="" alt="" class="img-fluid rounded mb-3">
                            <h6>Descri√ß√£o</h6>
                            <p id="modalEventDescription">Descri√ß√£o do evento...</p>
                            
                            <h6>Informa√ß√µes do Evento</h6>
                            <div class="row">
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-calendar me-2"></i><strong>Data:</strong> <span id="modalEventDate"></span></li>
                                        <li><i class="bi bi-clock me-2"></i><strong>Hor√°rio:</strong> <span id="modalEventTime"></span></li>
                                        <li><i class="bi bi-geo-alt me-2"></i><strong>Local:</strong> <span id="modalEventLocation"></span></li>
                                    </ul>
                                </div>
                                <div class="col-md-6">
                                    <ul class="list-unstyled">
                                        <li><i class="bi bi-people me-2"></i><strong>Capacidade:</strong> <span id="modalEventCapacity"></span></li>
                                        <li><i class="bi bi-star me-2"></i><strong>Avalia√ß√£o:</strong> <span id="modalEventRating"></span></li>
                                        <li><i class="bi bi-tag me-2"></i><strong>Categoria:</strong> <span id="modalEventCategory"></span></li>
                                    </ul>
                                </div>
                            </div>
                            
                            <h6>Ponto de Encontro</h6>
                            <p id="modalEventMeetingPoint">Ponto de encontro...</p>
                            
                            <h6>Tags</h6>
                            <div id="modalEventTags" class="mb-3"></div>
                            
                            <div id="modalEventPhotographer" class="photographer-offer" style="display: none;">
                                <h6><i class="bi bi-camera me-2"></i>Cobertura Fotogr√°fica Dispon√≠vel</h6>
                                <p>Este evento oferece servi√ßo de cobertura fotogr√°fica profissional.</p>
                                <p><strong>Valor:</strong> R$ <span id="modalPhotographyPrice">0,00</span></p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card">
                                <div class="card-body text-center">
                                    <h4 class="text-primary mb-3" id="modalEventPrice">R$ 0,00</h4>
                                    <div class="mb-3">
                                        <div class="d-flex justify-content-between mb-1">
                                            <small>Vagas ocupadas</small>
                                            <small><span id="modalCurrentParticipants">0</span>/<span id="modalMaxCapacity">0</span></small>
                                        </div>
                                        <div class="progress">
                                            <div class="progress-bar bg-success" id="modalProgressBar" style="width: 0%"></div>
                                        </div>
                                    </div>
                                    
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" onclick="registerForEvent()">
                                            <i class="bi bi-person-plus me-2"></i>Inscrever-se
                                        </button>
                                        <button class="btn btn-success whatsapp-btn" onclick="contactOrganizer()">
                                            <i class="bi bi-whatsapp me-2"></i>Contatar Organizador
                                        </button>
                                        <button class="btn btn-outline-primary" onclick="offerPhotography()" id="photographyOfferBtn" style="display: none;">
                                            <i class="bi bi-camera me-2"></i>Oferecer Fotografia
                                        </button>
                                    </div>
                                    
                                    <div class="mt-3">
                                        <small class="text-muted">
                                            <i class="bi bi-person me-1"></i>Organizador: <span id="modalOrganizerName">Nome</span>
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Fotos63 Eventos</h5>
                    <p>A maior plataforma de eventos esportivos e fotografia do Tocantins.</p>
                </div>
                <div class="col-md-6">
                    <h5>Links √öteis</h5>
                    <ul class="list-unstyled">
                        <li><a href="index.html" class="text-light">In√≠cio</a></li>
                        <li><a href="galeria.html" class="text-light">Galeria</a></li>
                        <li><a href="eventos.html" class="text-light">Eventos</a></li>
                        <li><a href="#" class="text-light">Criar Evento</a></li>
                    </ul>
                </div>
            </div>
            <hr class="my-4">
            <p class="text-center mb-0">&copy; 2024 Fotos63. Desenvolvido por MtsFerreira</p>
        </div>
    </footer>

    <script>
        // Configura√ß√£o do Supabase
        const supabaseUrl = 'https://wecgkxjlqeuhwpznauj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlY2dreGpscWV1aHdwem5hdWoiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTczNDg5NzQ4MSwiZXhwIjoyMDUwNDczNDgxfQ.YBgLlBCLKdHJBfnhqBqZvJNKNjOhCNfGqKBfCJgJJJE';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let allEvents = [];
        let displayedEvents = [];
        let categories = [];
        let currentFilter = '';
        let currentSearch = '';
        let currentSort = 'date_asc';
        let currentEvent = null;
        let eventsPerPage = 9;
        let currentPage = 0;

        // Carregar eventos
        async function loadEvents() {
            try {
                const { data: events, error } = await supabase
                    .from('eventos')
                    .select(`
                        *,
                        usuarios!organizador_id (
                            nome_completo,
                            email
                        )
                    `)
                    .eq('status', 'publicado')
                    .order('data_inicio', { ascending: true });

                if (error) throw error;

                allEvents = events || [];
                updateStats();
                applyFiltersAndDisplay();
            } catch (error) {
                console.error('Erro ao carregar eventos:', error);
                showExampleEvents();
            }

            document.getElementById('loading').style.display = 'none';
            document.getElementById('eventsGrid').style.display = 'block';
            document.getElementById('loadMoreBtn').style.display = 'block';
        }

        // Mostrar eventos de exemplo
        function showExampleEvents() {
            const exampleEvents = [
                {
                    id: 1,
                    titulo: "Corrida do Cerrado 2024",
                    descricao: "Corrida de 5km e 10km pelas trilhas do cerrado tocantinense. Evento beneficente em prol da preserva√ß√£o ambiental.",
                    tipo_evento: "corrida",
                    localizacao: "Parque Cesamar, Palmas - TO",
                    endereco_completo: "Parque Cesamar, Quadra 1503 Sul, Palmas - TO",
                    data_inicio: "2024-03-15T06:00:00-03:00",
                    data_fim: "2024-03-15T10:00:00-03:00",
                    horario_largada: "06:30:00",
                    ponto_encontro: "Entrada principal do Parque Cesamar",
                    preco_inscricao: 35.00,
                    capacidade_maxima: 500,
                    participantes_atuais: 287,
                    telefone_organizador: "(63) 99999-1234",
                    email_organizador: "corrida@cerrado.com",
                    url_imagem: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["corrida", "cerrado", "beneficente", "5km", "10km"],
                    permite_fotografos: true,
                    preco_cobertura_fotografica: 200.00,
                    avaliacao_media: 4.8,
                    total_avaliacoes: 45,
                    observacoes: "Kit do atleta inclui camiseta, medalha e lanche p√≥s-prova",
                    usuarios: { nome_completo: "Jo√£o Silva", email: "joao@eventos.com" }
                },
                {
                    id: 2,
                    titulo: "Pedalada do Jalap√£o",
                    descricao: "Passeio cicl√≠stico de 30km pelas dunas douradas do Jalap√£o. Inclui guia especializado e parada para fotos.",
                    tipo_evento: "ciclismo",
                    localizacao: "Mateiros - TO",
                    endereco_completo: "Centro de Mateiros, pr√≥ximo √† entrada do Parque Estadual do Jalap√£o",
                    data_inicio: "2024-03-22T07:00:00-03:00",
                    data_fim: "2024-03-22T12:00:00-03:00",
                    horario_largada: "07:30:00",
                    ponto_encontro: "Pra√ßa central de Mateiros",
                    preco_inscricao: 80.00,
                    capacidade_maxima: 30,
                    participantes_atuais: 18,
                    telefone_organizador: "(63) 99888-5678",
                    email_organizador: "pedalada@jalapao.com",
                    url_imagem: "https://images.unsplash.com/photo-1558618047-3c8c76ca7d13?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["ciclismo", "jalap√£o", "aventura", "dunas", "natureza"],
                    permite_fotografos: true,
                    preco_cobertura_fotografica: 300.00,
                    avaliacao_media: 4.9,
                    total_avaliacoes: 23,
                    observacoes: "Necess√°rio levar bike pr√≥pria. Capacete obrigat√≥rio.",
                    usuarios: { nome_completo: "Maria Santos", email: "maria@jalapao.com" }
                },
                {
                    id: 3,
                    titulo: "Travessia do Rio Tocantins",
                    descricao: "Competi√ß√£o de nata√ß√£o em √°guas abertas. Percurso de 2km atravessando o Rio Tocantins.",
                    tipo_evento: "natacao",
                    localizacao: "Praia da Graciosa, Palmas - TO",
                    endereco_completo: "Praia da Graciosa, Orla de Palmas - TO",
                    data_inicio: "2024-04-05T16:00:00-03:00",
                    data_fim: "2024-04-05T18:00:00-03:00",
                    horario_largada: "16:30:00",
                    ponto_encontro: "Deck da Praia da Graciosa",
                    preco_inscricao: 50.00,
                    capacidade_maxima: 100,
                    participantes_atuais: 67,
                    telefone_organizador: "(63) 99777-9012",
                    email_organizador: "travessia@tocantins.com",
                    url_imagem: "https://images.unsplash.com/photo-1530549387789-4c1017266635?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["nata√ß√£o", "rio tocantins", "√°guas abertas", "competi√ß√£o"],
                    permite_fotografos: true,
                    preco_cobertura_fotografica: 250.00,
                    avaliacao_media: 4.7,
                    total_avaliacoes: 31,
                    observacoes: "Obrigat√≥rio apresentar atestado m√©dico",
                    usuarios: { nome_completo: "Carlos Lima", email: "carlos@natacao.com" }
                }
            ];

            allEvents = exampleEvents;
            updateStats();
            loadCategories();
            applyFiltersAndDisplay();
        }

        // Carregar categorias
        function loadCategories() {
            const defaultCategories = [
                { nome: 'Todos', icone: 'bi-grid', cor: '#6c757d' },
                { nome: 'Corrida', icone: 'bi-person-running', cor: '#e74c3c' },
                { nome: 'Ciclismo', icone: 'bi-bicycle', cor: '#3498db' },
                { nome: 'Nata√ß√£o', icone: 'bi-water', cor: '#1abc9c' },
                { nome: 'Caminhada', icone: 'bi-tree', cor: '#27ae60' },
                { nome: 'Aventura', icone: 'bi-mountain', cor: '#f39c12' },
                { nome: 'Fam√≠lia', icone: 'bi-people', cor: '#9b59b6' }
            ];

            const categoryFilter = document.getElementById('categoryFilter');
            categoryFilter.innerHTML = '';

            defaultCategories.forEach((category, index) => {
                const categoryBtn = document.createElement('button');
                categoryBtn.className = `category-btn ${index === 0 ? 'active' : ''}`;
                categoryBtn.innerHTML = `<i class="${category.icone}"></i>${category.nome}`;
                categoryBtn.onclick = () => filterByCategory(category.nome === 'Todos' ? '' : category.nome.toLowerCase());
                categoryFilter.appendChild(categoryBtn);
            });
        }

        // Atualizar estat√≠sticas
        function updateStats() {
            document.getElementById('totalEvents').textContent = allEvents.length;
            
            const totalParticipants = allEvents.reduce((sum, event) => sum + (event.participantes_atuais || 0), 0);
            document.getElementById('totalParticipants').textContent = totalParticipants;
            
            const photographersCount = allEvents.filter(event => event.permite_fotografos).length;
            document.getElementById('totalPhotographers').textContent = photographersCount;
        }

        // Aplicar filtros e exibir
        function applyFiltersAndDisplay() {
            let filteredEvents = [...allEvents];

            // Aplicar filtro de categoria
            if (currentFilter) {
                filteredEvents = filteredEvents.filter(event => event.tipo_evento === currentFilter);
            }

            // Aplicar busca
            if (currentSearch) {
                filteredEvents = filteredEvents.filter(event => 
                    event.titulo.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    event.descricao.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    event.localizacao.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    event.tipo_evento.toLowerCase().includes(currentSearch.toLowerCase()) ||
                    event.tags?.some(tag => tag.toLowerCase().includes(currentSearch.toLowerCase()))
                );
            }

            // Aplicar ordena√ß√£o
            switch (currentSort) {
                case 'date_desc':
                    filteredEvents.sort((a, b) => new Date(b.data_inicio) - new Date(a.data_inicio));
                    break;
                case 'price_asc':
                    filteredEvents.sort((a, b) => a.preco_inscricao - b.preco_inscricao);
                    break;
                case 'price_desc':
                    filteredEvents.sort((a, b) => b.preco_inscricao - a.preco_inscricao);
                    break;
                case 'rating':
                    filteredEvents.sort((a, b) => (b.avaliacao_media || 0) - (a.avaliacao_media || 0));
                    break;
                case 'participants':
                    filteredEvents.sort((a, b) => (b.participantes_atuais || 0) - (a.participantes_atuais || 0));
                    break;
                default: // date_asc
                    filteredEvents.sort((a, b) => new Date(a.data_inicio) - new Date(b.data_inicio));
            }

            displayedEvents = filteredEvents;
            currentPage = 0;
            displayEvents();
        }

        // Exibir eventos
        function displayEvents() {
            const grid = document.getElementById('eventsGrid');
            const startIndex = currentPage * eventsPerPage;
            const endIndex = startIndex + eventsPerPage;
            const eventsToShow = displayedEvents.slice(0, endIndex);

            if (currentPage === 0) {
                grid.innerHTML = '';
            }

            eventsToShow.slice(startIndex).forEach(event => {
                const eventCard = document.createElement('div');
                eventCard.className = 'col-lg-4 col-md-6';
                
                const eventDate = new Date(event.data_inicio);
                const formattedDate = eventDate.toLocaleDateString('pt-BR');
                const formattedTime = event.horario_largada || eventDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                const capacityPercentage = event.capacidade_maxima ? 
                    Math.round((event.participantes_atuais / event.capacidade_maxima) * 100) : 0;
                
                const stars = generateStars(event.avaliacao_media || 0);
                
                eventCard.innerHTML = `
                    <div class="event-card">
                        <div class="position-relative">
                            <img src="${event.url_imagem}" alt="${event.titulo}" class="event-image">
                            <div class="event-badge">${event.tipo_evento}</div>
                            <div class="event-price">R$ ${event.preco_inscricao?.toFixed(2)}</div>
                        </div>
                        <div class="event-content">
                            <h5 class="event-title">${event.titulo}</h5>
                            <p class="event-description">${event.descricao?.substring(0, 120)}...</p>
                            
                            <div class="event-meta">
                                <div class="event-meta-item">
                                    <i class="bi bi-calendar"></i>
                                    <span>${formattedDate}</span>
                                </div>
                                <div class="event-meta-item">
                                    <i class="bi bi-clock"></i>
                                    <span>${formattedTime}</span>
                                </div>
                                <div class="event-meta-item">
                                    <i class="bi bi-geo-alt"></i>
                                    <span>${event.localizacao}</span>
                                </div>
                            </div>
                            
                            <div class="event-tags">
                                ${event.tags?.slice(0, 3).map(tag => `<span class="event-tag">#${tag}</span>`).join('') || ''}
                            </div>
                            
                            <div class="event-footer">
                                <div class="event-capacity">
                                    <span>${event.participantes_atuais}/${event.capacidade_maxima}</span>
                                    <div class="capacity-bar">
                                        <div class="capacity-fill" style="width: ${capacityPercentage}%"></div>
                                    </div>
                                </div>
                                <div class="event-rating">
                                    ${stars}
                                    <span>(${event.total_avaliacoes || 0})</span>
                                </div>
                            </div>
                            
                            <div class="d-flex gap-2 mt-3">
                                <button class="btn btn-primary flex-grow-1" onclick="viewEvent(${event.id})">
                                    <i class="bi bi-eye me-1"></i>Ver Detalhes
                                </button>
                                <button class="btn whatsapp-btn" onclick="contactOrganizerDirect('${event.telefone_organizador}', '${event.titulo}')">
                                    <i class="bi bi-whatsapp"></i>
                                </button>
                            </div>
                            
                            ${event.permite_fotografos ? `
                                <div class="photographer-offer mt-2">
                                    <small><i class="bi bi-camera me-1"></i>Cobertura fotogr√°fica dispon√≠vel por R$ ${event.preco_cobertura_fotografica?.toFixed(2)}</small>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
                
                grid.appendChild(eventCard);
            });

            // Controlar bot√£o "Carregar Mais"
            const loadMoreBtn = document.getElementById('loadMoreBtn');
            if (endIndex >= displayedEvents.length) {
                loadMoreBtn.style.display = 'none';
            } else {
                loadMoreBtn.style.display = 'block';
            }
        }

        // Gerar estrelas de avalia√ß√£o
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="bi bi-star-fill"></i>';
            }
            
            if (hasHalfStar) {
                stars += '<i class="bi bi-star-half"></i>';
            }
            
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="bi bi-star"></i>';
            }
            
            return stars;
        }

        // Ver detalhes do evento
        function viewEvent(eventId) {
            currentEvent = allEvents.find(e => e.id === eventId);
            if (!currentEvent) return;

            // Preencher modal
            document.getElementById('modalEventTitle').textContent = currentEvent.titulo;
            document.getElementById('modalEventImage').src = currentEvent.url_imagem;
            document.getElementById('modalEventDescription').textContent = currentEvent.descricao;
            
            const eventDate = new Date(currentEvent.data_inicio);
            document.getElementById('modalEventDate').textContent = eventDate.toLocaleDateString('pt-BR');
            document.getElementById('modalEventTime').textContent = currentEvent.horario_largada || eventDate.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('modalEventLocation').textContent = currentEvent.localizacao;
            document.getElementById('modalEventCapacity').textContent = `${currentEvent.participantes_atuais}/${currentEvent.capacidade_maxima}`;
            document.getElementById('modalEventRating').textContent = `${currentEvent.avaliacao_media?.toFixed(1) || 'N/A'} (${currentEvent.total_avaliacoes || 0} avalia√ß√µes)`;
            document.getElementById('modalEventCategory').textContent = currentEvent.tipo_evento;
            document.getElementById('modalEventMeetingPoint').textContent = currentEvent.ponto_encontro;
            document.getElementById('modalEventPrice').textContent = `R$ ${currentEvent.preco_inscricao?.toFixed(2)}`;
            document.getElementById('modalOrganizerName').textContent = currentEvent.usuarios?.nome_completo || 'Organizador';
            
            // Progress bar
            const capacityPercentage = currentEvent.capacidade_maxima ? 
                Math.round((currentEvent.participantes_atuais / currentEvent.capacidade_maxima) * 100) : 0;
            document.getElementById('modalProgressBar').style.width = `${capacityPercentage}%`;
            document.getElementById('modalCurrentParticipants').textContent = currentEvent.participantes_atuais;
            document.getElementById('modalMaxCapacity').textContent = currentEvent.capacidade_maxima;
            
            // Tags
            const tagsContainer = document.getElementById('modalEventTags');
            tagsContainer.innerHTML = '';
            if (currentEvent.tags) {
                currentEvent.tags.forEach(tag => {
                    const tagBadge = document.createElement('span');
                    tagBadge.className = 'event-tag me-1 mb-1';
                    tagBadge.textContent = `#${tag}`;
                    tagsContainer.appendChild(tagBadge);
                });
            }
            
            // Cobertura fotogr√°fica
            const photographerSection = document.getElementById('modalEventPhotographer');
            if (currentEvent.permite_fotografos && currentEvent.preco_cobertura_fotografica) {
                photographerSection.style.display = 'block';
                document.getElementById('modalPhotographyPrice').textContent = currentEvent.preco_cobertura_fotografica.toFixed(2);
            } else {
                photographerSection.style.display = 'none';
            }

            new bootstrap.Modal(document.getElementById('eventModal')).show();
        }

        // Filtrar por categoria
        function filterByCategory(category) {
            // Atualizar bot√µes ativos
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            currentFilter = category;
            applyFiltersAndDisplay();
        }

        // Buscar eventos
        function searchEvents() {
            currentSearch = document.getElementById('searchInput').value;
            applyFiltersAndDisplay();
        }

        // Ordenar eventos
        function sortEvents() {
            currentSort = document.getElementById('sortSelect').value;
            applyFiltersAndDisplay();
        }

        // Carregar mais eventos
        function loadMoreEvents() {
            currentPage++;
            displayEvents();
        }

        // Contatar organizador diretamente
        function contactOrganizerDirect(phone, eventTitle) {
            const message = `Ol√°! Tenho interesse no evento "${eventTitle}" divulgado no Fotos63. Poderia me dar mais informa√ß√µes?`;
            const whatsappUrl = `https://wa.me/55${phone.replace(/\D/g, '')}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Contatar organizador (do modal)
        function contactOrganizer() {
            if (!currentEvent) return;
            contactOrganizerDirect(currentEvent.telefone_organizador, currentEvent.titulo);
        }

        // Inscrever-se no evento
        function registerForEvent() {
            alert('Para se inscrever no evento, voc√™ precisa fazer login ou criar uma conta.');
            // Aqui seria implementada a l√≥gica de inscri√ß√£o
        }

        // Oferecer fotografia
        function offerPhotography() {
            alert('Para oferecer servi√ßos de fotografia, voc√™ precisa ser um fot√≥grafo cadastrado.');
            // Aqui seria implementada a l√≥gica de oferta fotogr√°fica
        }

        // Mostrar formul√°rio de cria√ß√£o de evento
        function showCreateEvent() {
            alert('Em breve voc√™ poder√° criar seus pr√≥prios eventos!');
            // Aqui seria implementado o formul√°rio de cria√ß√£o
        }

        // Mostrar login
        function showLogin() {
            alert('Sistema de login ser√° implementado em breve!');
        }

        // Mostrar registro
        function showRegister() {
            alert('Sistema de cadastro ser√° implementado em breve!');
        }

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', () => {
            loadCategories();
            loadEvents();
            
            // Busca ao pressionar Enter
            document.getElementById('searchInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    searchEvents();
                }
            });
        });
    </script>
</body>
</html>

