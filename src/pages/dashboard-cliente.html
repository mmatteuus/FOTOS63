<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Cliente - Fotos63</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        :root {
            --primary-color: #f39c12;
            --secondary-color: #e67e22;
            --accent-color: #d35400;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f1c40f;
            --info-color: #3498db;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            min-height: 100vh;
        }

        .navbar {
            background: white !important;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            font-weight: bold;
            color: var(--primary-color) !important;
        }

        .main-content {
            padding: 20px 0;
        }

        .search-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .photo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .photo-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .photo-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .photo-card img {
            width: 100%;
            height: 200px;
            object-fit: cover;
        }

        .photo-info {
            padding: 20px;
        }

        .photo-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--success-color);
        }

        .photographer-info {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .photographer-avatar {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, var(--primary-color), var(--secondary-color));
            border: none;
            border-radius: 25px;
            padding: 10px 25px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(243, 156, 18, 0.4);
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            position: sticky;
            top: 20px;
        }

        .cart-item {
            display: flex;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .cart-item img {
            width: 50px;
            height: 50px;
            object-fit: cover;
            border-radius: 8px;
            margin-right: 10px;
        }

        .favorite-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .favorite-btn:hover {
            background: white;
            transform: scale(1.1);
        }

        .favorite-btn.active {
            color: var(--danger-color);
        }

        .filter-section {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .category-filter {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .category-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary-color);
            background: transparent;
            color: var(--primary-color);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .category-btn.active,
        .category-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .footer {
            background: var(--dark-color);
            color: white;
            text-align: center;
            padding: 20px 0;
            margin-top: 50px;
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="bi bi-camera-fill me-2"></i>Fotos63
            </a>
            
            <div class="navbar-nav ms-auto">
                <div class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle me-2"></i><span id="userName">Cliente</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#" onclick="showFavorites()">
                            <i class="bi bi-heart me-2"></i>Meus Favoritos
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="showPurchases()">
                            <i class="bi bi-bag me-2"></i>Minhas Compras
                        </a></li>
                        <li><a class="dropdown-item" href="#" onclick="showProfile()">
                            <i class="bi bi-person me-2"></i>Meu Perfil
                        </a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="logout()">
                            <i class="bi bi-box-arrow-right me-2"></i>Sair
                        </a></li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <div class="container main-content">
        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-9">
                <!-- Search Section -->
                <div class="search-section">
                    <h2 class="mb-4">Explore Fotos Incríveis</h2>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="input-group">
                                <input type="text" class="form-control form-control-lg" id="searchInput" 
                                       placeholder="Buscar por título, descrição, fotógrafo...">
                                <button class="btn btn-primary" onclick="searchPhotos()">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <select class="form-control form-control-lg" id="sortSelect" onchange="sortPhotos()">
                                <option value="recent">Mais Recentes</option>
                                <option value="price_asc">Menor Preço</option>
                                <option value="price_desc">Maior Preço</option>
                                <option value="popular">Mais Populares</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Filter Section -->
                <div class="filter-section">
                    <h5 class="mb-3">Filtrar por Categoria</h5>
                    <div class="category-filter">
                        <button class="category-btn active" onclick="filterByCategory('')">Todas</button>
                        <button class="category-btn" onclick="filterByCategory('eventos')">Eventos</button>
                        <button class="category-btn" onclick="filterByCategory('esportes')">Esportes</button>
                        <button class="category-btn" onclick="filterByCategory('natureza')">Natureza</button>
                        <button class="category-btn" onclick="filterByCategory('retratos')">Retratos</button>
                        <button class="category-btn" onclick="filterByCategory('arquitetura')">Arquitetura</button>
                        <button class="category-btn" onclick="filterByCategory('arte')">Arte</button>
                    </div>
                </div>

                <!-- Photos Grid -->
                <div id="photosGrid" class="photo-grid">
                    <!-- Fotos serão carregadas aqui -->
                </div>

                <!-- Load More Button -->
                <div class="text-center mt-4">
                    <button class="btn btn-outline-primary btn-lg" id="loadMoreBtn" onclick="loadMorePhotos()">
                        Carregar Mais Fotos
                    </button>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-3">
                <!-- Cart -->
                <div class="sidebar mb-4">
                    <h5 class="mb-3">
                        <i class="bi bi-cart me-2"></i>Carrinho 
                        <span class="badge bg-primary" id="cartCount">0</span>
                    </h5>
                    <div id="cartItems">
                        <p class="text-muted text-center">Seu carrinho está vazio</p>
                    </div>
                    <div class="d-grid gap-2 mt-3">
                        <div class="d-flex justify-content-between">
                            <strong>Total: <span id="cartTotal">R$ 0,00</span></strong>
                        </div>
                        <button class="btn btn-primary" id="checkoutBtn" onclick="checkout()" disabled>
                            <i class="bi bi-credit-card me-2"></i>Finalizar Compra
                        </button>
                    </div>
                </div>

                <!-- Favorites -->
                <div class="sidebar">
                    <h5 class="mb-3">
                        <i class="bi bi-heart me-2"></i>Favoritos 
                        <span class="badge bg-danger" id="favoritesCount">0</span>
                    </h5>
                    <div id="favoritesList">
                        <p class="text-muted text-center">Nenhum favorito ainda</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Photo Modal -->
    <div class="modal fade" id="photoModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalPhotoTitle">Título da Foto</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <img id="modalPhotoImage" src="" alt="" class="img-fluid rounded">
                        </div>
                        <div class="col-md-4">
                            <div class="photo-details">
                                <h6>Descrição</h6>
                                <p id="modalPhotoDescription">Descrição da foto...</p>
                                
                                <h6>Fotógrafo</h6>
                                <div class="photographer-info">
                                    <img id="modalPhotographerAvatar" src="" alt="" class="photographer-avatar">
                                    <span id="modalPhotographerName">Nome do Fotógrafo</span>
                                </div>
                                
                                <h6 class="mt-3">Categoria</h6>
                                <span class="badge bg-secondary" id="modalPhotoCategory">Categoria</span>
                                
                                <h6 class="mt-3">Tags</h6>
                                <div id="modalPhotoTags"></div>
                                
                                <div class="mt-4">
                                    <div class="photo-price mb-3" id="modalPhotoPrice">R$ 0,00</div>
                                    <div class="d-grid gap-2">
                                        <button class="btn btn-primary" onclick="addToCart()">
                                            <i class="bi bi-cart-plus me-2"></i>Adicionar ao Carrinho
                                        </button>
                                        <button class="btn btn-success" onclick="buyNow()">
                                            <i class="bi bi-lightning me-2"></i>Comprar Agora
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <p class="mb-0">&copy; 2024 Fotos63. Desenvolvido por MtsFerreira</p>
        </div>
    </footer>

    <script>
        // Configuração do Supabase
        const supabaseUrl = 'https://wecgkxjlqeuhwpznauj.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6IndlY2dreGpscWV1aHdwem5hdWoiLCJyb2xlIjoiYW5vbiIsImlhdCI6MTczNDg5NzQ4MSwiZXhwIjoyMDUwNDczNDgxfQ.YBgLlBCLKdHJBfnhqBqZvJNKNjOhCNfGqKBfCJgJJJE';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        let currentUser = null;
        let allPhotos = [];
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        let favorites = JSON.parse(localStorage.getItem('favorites')) || [];
        let currentPhoto = null;

        // Verificar autenticação
        async function checkAuth() {
            const { data: { user } } = await supabase.auth.getUser();
            
            if (!user) {
                window.location.href = 'index.html';
                return;
            }

            currentUser = user;
            document.getElementById('userName').textContent = user.user_metadata?.full_name || user.email;
            
            loadPhotos();
            updateCartUI();
            updateFavoritesUI();
        }

        // Carregar fotos
        async function loadPhotos() {
            try {
                const { data: photos, error } = await supabase
                    .from('fotos')
                    .select(`
                        *,
                        fotografos (
                            nome_completo,
                            avatar_url
                        )
                    `)
                    .eq('status', 'ativa')
                    .order('created_at', { ascending: false });

                if (error) throw error;

                allPhotos = photos || [];
                displayPhotos(allPhotos);
            } catch (error) {
                console.error('Erro ao carregar fotos:', error);
                // Mostrar fotos de exemplo se não conseguir carregar do banco
                showExamplePhotos();
            }
        }

        // Mostrar fotos de exemplo
        function showExamplePhotos() {
            const examplePhotos = [
                {
                    id: 1,
                    titulo: "Pôr do Sol no Jalapão",
                    descricao: "Linda paisagem do pôr do sol no Parque Estadual do Jalapão",
                    preco: 25.00,
                    categoria: "natureza",
                    url_foto: "https://images.unsplash.com/photo-1469474968028-56623f02e42e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["jalapão", "pôr do sol", "natureza"],
                    fotografos: { nome_completo: "João Silva", avatar_url: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" }
                },
                {
                    id: 2,
                    titulo: "Casamento na Praia",
                    descricao: "Momento especial de um casal apaixonado",
                    preco: 45.00,
                    categoria: "eventos",
                    url_foto: "https://images.unsplash.com/photo-1511285560929-80b456fea0bc?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["casamento", "praia", "amor"],
                    fotografos: { nome_completo: "Maria Santos", avatar_url: "https://images.unsplash.com/photo-1494790108755-2616b612b786?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" }
                },
                {
                    id: 3,
                    titulo: "Corrida de Rua",
                    descricao: "Atleta em ação durante competição",
                    preco: 30.00,
                    categoria: "esportes",
                    url_foto: "https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
                    tags: ["corrida", "esporte", "atleta"],
                    fotografos: { nome_completo: "Carlos Lima", avatar_url: "https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-4.0.3&auto=format&fit=crop&w=100&q=80" }
                }
            ];

            allPhotos = examplePhotos;
            displayPhotos(allPhotos);
        }

        // Exibir fotos
        function displayPhotos(photos) {
            const grid = document.getElementById('photosGrid');
            grid.innerHTML = '';

            photos.forEach(photo => {
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-card';
                photoCard.style.position = 'relative';
                
                const isFavorite = favorites.includes(photo.id);
                
                photoCard.innerHTML = `
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" onclick="toggleFavorite(${photo.id})">
                        <i class="bi bi-heart${isFavorite ? '-fill' : ''}"></i>
                    </button>
                    <img src="${photo.url_foto}" alt="${photo.titulo}">
                    <div class="photo-info">
                        <h6 class="mb-2">${photo.titulo}</h6>
                        <p class="text-muted small mb-2">${photo.descricao?.substring(0, 80)}...</p>
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="badge bg-secondary">${photo.categoria}</span>
                            <span class="photo-price">R$ ${photo.preco?.toFixed(2)}</span>
                        </div>
                        <div class="photographer-info">
                            <img src="${photo.fotografos?.avatar_url || 'https://via.placeholder.com/30'}" 
                                 alt="${photo.fotografos?.nome_completo}" class="photographer-avatar">
                            <small class="text-muted">${photo.fotografos?.nome_completo}</small>
                        </div>
                        <div class="d-grid gap-2 mt-3">
                            <button class="btn btn-primary btn-sm" onclick="viewPhoto(${photo.id})">
                                <i class="bi bi-eye me-1"></i>Ver Detalhes
                            </button>
                        </div>
                    </div>
                `;
                
                grid.appendChild(photoCard);
            });
        }

        // Ver detalhes da foto
        function viewPhoto(photoId) {
            currentPhoto = allPhotos.find(p => p.id === photoId);
            if (!currentPhoto) return;

            document.getElementById('modalPhotoTitle').textContent = currentPhoto.titulo;
            document.getElementById('modalPhotoImage').src = currentPhoto.url_foto;
            document.getElementById('modalPhotoDescription').textContent = currentPhoto.descricao;
            document.getElementById('modalPhotographerName').textContent = currentPhoto.fotografos?.nome_completo;
            document.getElementById('modalPhotographerAvatar').src = currentPhoto.fotografos?.avatar_url || 'https://via.placeholder.com/30';
            document.getElementById('modalPhotoCategory').textContent = currentPhoto.categoria;
            document.getElementById('modalPhotoPrice').textContent = `R$ ${currentPhoto.preco?.toFixed(2)}`;

            // Tags
            const tagsContainer = document.getElementById('modalPhotoTags');
            tagsContainer.innerHTML = '';
            if (currentPhoto.tags) {
                currentPhoto.tags.forEach(tag => {
                    const tagBadge = document.createElement('span');
                    tagBadge.className = 'badge bg-light text-dark me-1';
                    tagBadge.textContent = tag;
                    tagsContainer.appendChild(tagBadge);
                });
            }

            new bootstrap.Modal(document.getElementById('photoModal')).show();
        }

        // Adicionar ao carrinho
        function addToCart() {
            if (!currentPhoto) return;
            
            if (!cart.find(item => item.id === currentPhoto.id)) {
                cart.push({
                    id: currentPhoto.id,
                    titulo: currentPhoto.titulo,
                    preco: currentPhoto.preco,
                    url_foto: currentPhoto.url_foto
                });
                
                localStorage.setItem('cart', JSON.stringify(cart));
                updateCartUI();
                
                // Fechar modal
                bootstrap.Modal.getInstance(document.getElementById('photoModal')).hide();
                
                // Mostrar feedback
                alert('Foto adicionada ao carrinho!');
            } else {
                alert('Esta foto já está no seu carrinho!');
            }
        }

        // Comprar agora
        function buyNow() {
            addToCart();
            checkout();
        }

        // Toggle favorito
        function toggleFavorite(photoId) {
            const index = favorites.indexOf(photoId);
            if (index > -1) {
                favorites.splice(index, 1);
            } else {
                favorites.push(photoId);
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
            updateFavoritesUI();
            displayPhotos(allPhotos); // Recarregar para atualizar ícones
        }

        // Atualizar UI do carrinho
        function updateCartUI() {
            const cartCount = document.getElementById('cartCount');
            const cartItems = document.getElementById('cartItems');
            const cartTotal = document.getElementById('cartTotal');
            const checkoutBtn = document.getElementById('checkoutBtn');

            cartCount.textContent = cart.length;

            if (cart.length === 0) {
                cartItems.innerHTML = '<p class="text-muted text-center">Seu carrinho está vazio</p>';
                cartTotal.textContent = 'R$ 0,00';
                checkoutBtn.disabled = true;
            } else {
                cartItems.innerHTML = '';
                let total = 0;

                cart.forEach(item => {
                    total += item.preco;
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <img src="${item.url_foto}" alt="${item.titulo}">
                        <div class="flex-grow-1">
                            <small class="d-block">${item.titulo}</small>
                            <strong class="text-success">R$ ${item.preco.toFixed(2)}</strong>
                        </div>
                        <button class="btn btn-sm btn-outline-danger" onclick="removeFromCart(${item.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    `;
                    cartItems.appendChild(cartItem);
                });

                cartTotal.textContent = `R$ ${total.toFixed(2)}`;
                checkoutBtn.disabled = false;
            }
        }

        // Atualizar UI dos favoritos
        function updateFavoritesUI() {
            const favoritesCount = document.getElementById('favoritesCount');
            const favoritesList = document.getElementById('favoritesList');

            favoritesCount.textContent = favorites.length;

            if (favorites.length === 0) {
                favoritesList.innerHTML = '<p class="text-muted text-center">Nenhum favorito ainda</p>';
            } else {
                favoritesList.innerHTML = '';
                favorites.forEach(photoId => {
                    const photo = allPhotos.find(p => p.id === photoId);
                    if (photo) {
                        const favoriteItem = document.createElement('div');
                        favoriteItem.className = 'cart-item';
                        favoriteItem.innerHTML = `
                            <img src="${photo.url_foto}" alt="${photo.titulo}">
                            <div class="flex-grow-1">
                                <small class="d-block">${photo.titulo}</small>
                                <strong class="text-success">R$ ${photo.preco.toFixed(2)}</strong>
                            </div>
                            <button class="btn btn-sm btn-outline-danger" onclick="toggleFavorite(${photo.id})">
                                <i class="bi bi-heart-fill"></i>
                            </button>
                        `;
                        favoritesList.appendChild(favoriteItem);
                    }
                });
            }
        }

        // Remover do carrinho
        function removeFromCart(photoId) {
            cart = cart.filter(item => item.id !== photoId);
            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartUI();
        }

        // Filtrar por categoria
        function filterByCategory(category) {
            // Atualizar botões ativos
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            // Filtrar fotos
            const filteredPhotos = category ? 
                allPhotos.filter(photo => photo.categoria === category) : 
                allPhotos;
            
            displayPhotos(filteredPhotos);
        }

        // Buscar fotos
        function searchPhotos() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            const filteredPhotos = allPhotos.filter(photo => 
                photo.titulo.toLowerCase().includes(query) ||
                photo.descricao.toLowerCase().includes(query) ||
                photo.fotografos?.nome_completo.toLowerCase().includes(query)
            );
            displayPhotos(filteredPhotos);
        }

        // Checkout
        function checkout() {
            if (cart.length === 0) return;
            
            alert('Funcionalidade de pagamento será implementada em breve!');
        }

        // Logout
        async function logout() {
            await supabase.auth.signOut();
            window.location.href = 'index.html';
        }

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
        });
    </script>
</body>
</html>

